@model BarbersClub.Business.DTOs.UserUpdateRequest

@{ Layout = "_Layout"; }
@{
    ViewData["Title"] = "Editar Perfil";
}

@section Styles {
    <link rel="stylesheet" href="~/css/navbar/EditProfile.css" asp-append-version="true" />
}

<div class="auth-container">
    <form id="userProfileEditForm" action="/api/users/edit" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()

        <h2>Editar Perfil</h2>

        <div class="profile-picture-container">
            <img id="image-preview"
                 src="@(string.IsNullOrEmpty(Model.CurrentProfilePicUrl) ? "/images/default-avatar.png" : Url.Content(Model.CurrentProfilePicUrl))"
                 alt="Foto de Perfil" 
                 onerror="this.onerror=null; this.src='/images/default-avatar.png';" />
            
            <label for="ProfilePicFile" class="picture-overlay">
                <i class="bi bi-camera-fill"></i>
                <span>Alterar Foto</span>
            </label>
            <input asp-for="ProfilePicFile" type="file" accept="image/*" class="d-none" />
        </div>

        <div class="form-floating mb-3">
            <input asp-for="FirstName" type="text" class="form-control" placeholder="Nome" required>
            <label asp-for="FirstName">Nome</label>
        </div>
        <div class="form-floating mb-3">
            <input asp-for="LastName" type="text" class="form-control" placeholder="Sobrenome" required>
            <label asp-for="LastName">Sobrenome</label>
        </div>
        <div class="form-floating mb-3">
            <input asp-for="Email" type="email" class="form-control" placeholder="Email" required>
            <label asp-for="Email">Email</label>
        </div>

        <hr />

        <div class="form-floating mb-3">
            <input asp-for="NewPassword" type="password" class="form-control" placeholder="Nova Senha">
            <label asp-for="NewPassword">Nova Senha (opcional)</label>
        </div>
        <div class="form-floating mb-4">
            <input asp-for="ConfirmPassword" type="password" class="form-control" placeholder="Confirmar Nova Senha">
            <label asp-for="ConfirmPassword">Confirmar Nova Senha</label>
        </div>
        
        <div id="errorMessage" class="alert alert-danger d-none" role="alert"></div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg">
                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                Salvar Alterações
            </button>
            <a asp-controller="UserProfile" asp-action="UserProfile" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="~/js/NavBar/EditProfile.js" asp-append-version="true"></script>
}