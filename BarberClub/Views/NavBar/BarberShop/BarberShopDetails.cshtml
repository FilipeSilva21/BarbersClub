@using System.Globalization
@model BarberClub.Models.BarberShop

@{
    ViewData["Title"] = Model.Name;

    var averageRating = Model.Ratings != null && Model.Ratings.Any()
        ? Model.Ratings.Average(r => r.RatingValue).ToString("F1")
        : "N/A";
    var ratingCount = Model.Ratings?.Count() ?? 0;
}

@section Styles {
    <link rel="stylesheet" href="~/css/NavBar/BarberShop/BarberShopDetails.css" asp-append-version="true" />
}

<div id="barbershop-details-view" class="container my-5">

    <header class="text-center mb-5">
        <h1 class="display-4 fw-bold">@Model.Name</h1>
        <p class="lead text-white-50 fs-5">
            <i class="bi bi-geo-alt-fill me-2"></i>@Model.Address, @Model.City - @Model.State
        </p>
        <div class="average-rating fs-4">
            <i class="bi bi-star-fill text-gold"></i>
            <span>@averageRating</span>
            <span class="text-white-50">(@ratingCount avaliações)</span>
        </div>
    </header>

    <div class="row g-5">
        <div class="col-lg-7">
            <div class="details-card p-0 mb-4">
                <img src="@(Model.Images?.FirstOrDefault()?.ImagePath ?? "https://via.placeholder.com/800x500")" alt="Foto da Barbearia @Model.Name" class="img-fluid rounded-top">
            </div>

            <div class="details-card">
                <h3 class="fw-bold mb-3">Informações</h3>
                <ul class="list-unstyled info-list">
                    <li><i class="bi bi-telephone-fill me-3"></i>@Model.WhatsApp</li>
                    <li><i class="bi bi-person-fill me-3"></i>Barbeiro: @Model.Barber?.FirstName @Model.Barber?.LastName</li>
                    <li><i class="bi bi-calendar-week-fill me-3"></i>Funciona: @(Model.WorkingDays != null ? string.Join(", ", Model.WorkingDays) : "Não informado")</li>
                    <li><i class="bi bi-clock-fill me-3"></i>Horário: @Model.OpeningHours - @Model.ClosingHours</li>
                </ul>
            </div>
        </div>

        <div class="col-lg-5">

            <div class="details-card mb-4">
                <h3 class="fw-bold mb-4">Serviços e Preços</h3>
                @if (Model.OfferedServices != null && Model.OfferedServices.Any())
                {
                    <ul class="list-unstyled services-list">
                        @foreach (var offeredService in Model.OfferedServices.OrderBy(s => s.Price))
                        {
                            <li class="d-flex justify-content-between align-items-center mb-2">
                                <span>
                                    <i class="bi bi-scissors text-gold me-2"></i>
                                    @System.Text.RegularExpressions.Regex.Replace(offeredService.ServiceType.ToString(), "(\\B[A-Z])", " $1")
                                </span>
                                <span class="fw-bold text-gold">
                                    @offeredService.Price.ToString("C", CultureInfo.GetCultureInfo("pt-BR"))
                                </span>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p class="text-white-50">Nenhum serviço cadastrado ainda.</p>
                }
                <a asp-controller="Service" 
                   asp-action="CreateServiceForBarberShop" 
                   asp-route-barberShopId="@Model.BarberShopId" 
                   class="btn btn-gold w-100 mt-4">
                    Agendar Horário
                </a>
            </div>
            <div class="details-card">
                <h3 class="fw-bold mb-4">Avaliações de Clientes</h3>
                @if (Model.Ratings != null && Model.Ratings.Any())
                {
                    <div class="ratings-list">
                        @foreach (var rating in Model.Ratings.Take(5))
                        {
                            }
                    </div>
                }
                else
                {
                    <p class="text-white-50">Esta barbearia ainda não possui avaliações.</p>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/NavBar/BarberShop/BarberShopDetails.js" asp-append-version="true"></script>
}